<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadual Aktiviti HP105 - RBPF</title>
    <script src="js/api-client.js?v=7"></script>
    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #1e3a8a;
            --accent-blue: #3b82f6;
            --light-bg: #f1f5fb;
            --card-bg: #ffffff;
            --border-color: #dae0e9;
            --text-dark: #0d1b3d;
            --text-muted: #5e6a84;
            --success-green: #22c55e;
            --weekend-yellow: #fef3c7;
            --shadow-sm: 0 2px 8px rgba(9, 26, 69, 0.08);
            --shadow-md: 0 10px 25px rgba(4, 10, 27, 0.1);
            --shadow-lg: 0 22px 40px rgba(9, 26, 69, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', system-ui, sans-serif;
            background: radial-gradient(circle at top, #ffffff 0%, #e7eef9 60%);
            min-height: 100vh;
            padding: 0;
            color: var(--text-dark);
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px 40px;
        }

        .top-bar {
            background: white;
            padding: 0.75rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 0;
            margin-bottom: 24px;
        }

        .top-bar h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .home-link {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.9rem;
            background: #4f46e5;
            color: white;
            text-decoration: none;
            border-radius: 0.5rem;
            font-size: 0.8125rem;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
        }

        .home-link:hover {
            background: #4338ca;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.35);
        }

        .home-link svg {
            width: 1rem;
            height: 1rem;
        }

        @media (max-width: 768px) {
            .top-bar {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                gap: 0.5rem;
                padding: 0.75rem 1rem;
            }
            
            .top-bar h1 {
                font-size: 1.25rem;
                flex: 1;
            }

            .home-link {
                padding: 0.4rem 0.65rem;
                font-size: 0.75rem;
                gap: 0.25rem;
                white-space: nowrap;
            }
            
            .home-link svg {
                width: 0.875rem;
                height: 0.875rem;
            }
        }

        .calendar-container {
            background: var(--card-bg);
            border-radius: 22px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .calendar-title {
            padding: 16px 32px;
            background: linear-gradient(180deg, #f9fafb, #f3f4f6);
            border-bottom: 2px solid #d1d5db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .calendar-wrapper {
            position: relative;
            overflow-x: auto;
            overflow-y: visible;
            scroll-behavior: smooth;
            padding: 20px;
            transform-origin: top left;
        }

        /* Professional scrollbar */
        .calendar-wrapper::-webkit-scrollbar {
            height: 14px;
        }

        .calendar-wrapper::-webkit-scrollbar-track {
            background: #f1f5fb;
            border-radius: 10px;
            margin: 0 20px;
            border: 1px solid var(--border-color);
        }

        .calendar-wrapper::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #93c5fd, #60a5fa);
            border-radius: 10px;
            border: 2px solid #f1f5fb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .calendar-wrapper::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #60a5fa, #93c5fd);
        }


        table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            min-width: 1600px;
        }

        th, td {
            border: 1px solid var(--border-color);
            text-align: center;
            padding: 16px 10px;
            min-width: 45px;
            max-width: 120px;
            min-height: 50px;
            height: auto;
            color: #000000;
            transition: all 0.2s ease;
            vertical-align: top;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
        }

        /* Month header */
        .month-header {
            background: white;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 15px;
            text-align: center;
            position: sticky;
            left: 0;
            z-index: 4;
        }

        /* Sticky left column (activity names) - Soft Gray */
        thead th:first-child,
        tbody th:first-child {
            position: sticky;
            left: 0;
            background: linear-gradient(180deg, #f3f4f6, #e5e7eb);
            font-weight: 700;
            text-align: left;
            padding-left: 20px;
            min-width: 160px;
            z-index: 3;
            border-right: 2px solid #d1d5db;
            color: #000000;
            font-size: 0.95rem;
            box-shadow: 3px 0 6px rgba(0,0,0,0.04);
        }

        /* Sticky Tindakan column */
        thead tr:nth-child(2) th:nth-child(2),
        tbody td:nth-child(2) {
            position: sticky;
            left: 160px;
            background: linear-gradient(180deg, #e5e7eb, #d1d5db);
            font-weight: 600;
            text-align: center;
            min-width: 140px;
            min-height: 50px;
            z-index: 3;
            border-right: 1px solid #9ca3af;
            color: #000000;
            font-size: 0.9rem;
            box-shadow: 3px 0 6px rgba(0,0,0,0.04);
        }

        /* Sticky Status column */
        thead tr:nth-child(2) th:nth-child(3),
        tbody td:nth-child(3) {
            position: sticky;
            left: 300px;
            background: linear-gradient(180deg, #e5e7eb, #d1d5db);
            font-weight: 600;
            text-align: center;
            min-width: 100px;
            min-height: 50px;
            z-index: 3;
            border-right: 2px solid #9ca3af;
            color: #000000;
            font-size: 0.9rem;
            box-shadow: 3px 0 6px rgba(0,0,0,0.04);
        }

        /* Empty cells in Hari row (positions 2 and 3) */
        thead tr:first-child th:nth-child(2),
        thead tr:first-child th:nth-child(3) {
            position: sticky;
            left: 160px;
            min-width: 140px;
            background: linear-gradient(180deg, #e5e7eb, #d1d5db);
            border-right: 1px solid #9ca3af;
        }

        thead tr:first-child th:nth-child(3) {
            left: 300px;
            min-width: 100px;
            border-right: 2px solid #9ca3af;
        }

        tbody td:nth-child(2),
        tbody td:nth-child(3) {
            font-size: 0.8rem;
            padding: 10px 8px;
            color: #000000;
            font-weight: 500;
        }

        tbody td:nth-child(2) {
            font-weight: 600;
        }

        /* Sticky top header row (day names) - Soft Gray */
        thead tr:first-child th {
            position: sticky;
            top: 0;
            background: linear-gradient(180deg, #e5e7eb, #d1d5db);
            color: #000000;
            font-weight: 700;
            z-index: 2;
            border-bottom: 2px solid #9ca3af;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            text-shadow: none;
            padding: 8px 10px !important;
            min-height: 35px !important;
            height: 35px !important;
        }

        /* Sticky date row - Soft Gray */
        thead tr:nth-child(2) th {
            position: sticky;
            top: 35px;
            background: linear-gradient(180deg, #d1d5db, #e5e7eb);
            font-weight: 700;
            z-index: 2;
            border-bottom: 2px solid #9ca3af;
            color: #000000;
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 8px 10px !important;
            min-height: 38px !important;
            height: 38px !important;
        }

        /* Make sure top-left sticky columns are above everything - Soft Gray */
        thead tr:first-child th:first-child,
        thead tr:nth-child(2) th:first-child {
            z-index: 5;
            background: linear-gradient(135deg, #d1d5db, #9ca3af);
            color: #000000;
            font-weight: 700;
        }

        thead tr:nth-child(2) th:nth-child(2),
        thead tr:nth-child(2) th:nth-child(3) {
            z-index: 5;
        }

        /* Day names styling */
        .day-name {
            font-size: 0.85rem;
            color: #000000;
            font-weight: 700;
            letter-spacing: 0.08em;
        }

        /* Date styling */
        .date-num {
            font-size: 1rem;
            font-weight: 700;
            color: #000000;
        }

        /* Current date highlight - Kemuncak HP105 - Soft Turquoise */
        .current-date {
            background: linear-gradient(135deg, #a5f3fc, #67e8f9) !important;
            color: #000000 !important;
            font-weight: 700 !important;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08),
                        0 2px 6px rgba(6, 182, 212, 0.15);
            border: 2px solid #67e8f9 !important;
            position: relative;
        }

        thead th.current-date {
            background: linear-gradient(135deg, #a5f3fc, #67e8f9) !important;
            color: #000000 !important;
            text-shadow: none;
        }

        /* Weekend/Public Holiday highlight (Friday & Sunday) - Soft Pastel Yellow */
        .weekend {
            background: linear-gradient(180deg, #fef9e7, #fef4d4) !important;
            border-left: 1px solid #fde68a;
            border-right: 1px solid #fde68a;
        }
        
        thead th.weekend {
            background: linear-gradient(135deg, #fcd34d, #fde68a) !important;
            color: #000000 !important;
            text-shadow: none;
        }
        
        tbody td.weekend {
            background: linear-gradient(180deg, #fef9e7, #fef4d4) !important;
        }

        /* Event cell - Soft Pastel Blue */
        .event-cell {
            background: linear-gradient(135deg, #93c5fd, #bfdbfe) !important;
            color: #000000;
            font-weight: 600;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05), 
                        0 1px 3px rgba(59, 130, 246, 0.1);
            position: relative;
            border: 1px solid #93c5fd !important;
        }

        /* Blue highlight for cells with imported calendar events */
        .has-calendar-event {
            background: linear-gradient(135deg, #93c5fd, #bfdbfe) !important;
            border: 2px solid #3b82f6 !important;
            position: relative;
            color: #000000 !important;
            font-weight: 600 !important;
            font-size: 0.75rem !important;
            text-align: center !important;
            vertical-align: middle !important;
            padding: 6px 4px !important;
            line-height: 1.3 !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            white-space: normal !important;
            max-width: 100% !important;
            height: auto !important;
            min-height: auto !important;
        }

        .has-calendar-event::after {
            content: '';
            /* Removed emoji so text is more visible */
        }
        
        /* Inline edit buttons */
        .inline-edit-buttons {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            justify-content: center;
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
        }
        
        .inline-save-btn, .inline-cancel-btn {
            padding: 3px 8px;
            font-size: 0.65rem;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .inline-save-btn {
            background: #10b981;
            color: white;
        }
        
        .inline-save-btn:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .inline-cancel-btn {
            background: #ef4444;
            color: white;
        }
        
        .inline-cancel-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        /* Make cells flexible to accommodate buttons and text */
        td.has-calendar-event {
            position: relative;
            padding: 6px 4px 28px 4px !important;
            height: auto !important;
            min-height: 50px;
            max-width: 120px !important;
            width: 100px !important;
            vertical-align: top !important;
        }
        
        /* Ensure span inside event cells wraps properly */
        td.has-calendar-event span {
            word-break: break-word !important;
            overflow-wrap: break-word !important;
            white-space: normal !important;
            display: block !important;
            max-width: 100% !important;
            hyphens: auto !important;
        }
        
        /* Visual feedback for editable cells (super admin only) */
        td.editable-event-cell::before {
            content: '✏️';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.65rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        td.editable-event-cell:hover::before {
            opacity: 1;
        }
        
        td.has-calendar-event[contenteditable="false"]:hover {
            cursor: text;
            background: linear-gradient(135deg, #bfdbfe, #dbeafe) !important;
            box-shadow: 0 0 0 2px #3b82f6;
        }
        
        /* Cell being edited */
        td.has-calendar-event[contenteditable="true"] {
            background: #dbeafe !important;
            outline: 3px solid #3b82f6 !important;
            cursor: text;
        }
        
        /* All cells clickable for super admin */
        td.admin-clickable:hover {
            box-shadow: inset 0 0 0 2px #3b82f6;
            transition: box-shadow 0.2s;
        }
        
        /* Editable text cells (Tindakan & Status) */
        .admin-editable-text {
            position: relative;
            transition: all 0.2s;
        }
        
        .admin-editable-text::after {
            content: '✏️';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.6rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .admin-editable-text:hover::after {
            opacity: 0.6;
        }
        
        .inline-text-edit {
            font-family: inherit;
            outline: none;
        }
        
        .inline-text-edit:focus {
            border-color: #2563eb !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Empty cells hint for super admin */
        td.admin-clickable.empty::after {
            content: '+';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: #9ca3af;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        td.admin-clickable.empty:hover::after {
            opacity: 0.5;
        }

        /* Training/Preparation phases with progressive intensity */
        .prep-early {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe) !important;
            color: #000000;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            vertical-align: middle;
        }

        .prep-mid {
            background: linear-gradient(135deg, #bfdbfe, #93c5fd) !important;
            color: #000000;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
            vertical-align: middle;
        }

        .prep-final {
            background: linear-gradient(135deg, #93c5fd, #60a5fa) !important;
            color: #000000;
            font-size: 0.75rem;
            font-weight: 700;
            text-align: center;
            vertical-align: middle;
        }

        /* Main Event Day - Bold and prominent */
        .main-event {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
            color: #000000 !important;
            font-weight: 800;
            font-size: 0.8rem;
            text-align: center;
            vertical-align: middle;
            border: 3px solid #1e40af !important;
            box-shadow: 0 0 0 2px white, 0 4px 12px rgba(59, 130, 246, 0.5) !important;
            position: relative;
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 0 2px white, 0 4px 12px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 0 2px white, 0 4px 16px rgba(59, 130, 246, 0.8);
            }
        }

        .main-event::before {
            content: '⭐';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
        }

        /* Remove latihan from weekend cells */
        .weekend.prep-early,
        .weekend.prep-mid,
        .weekend.prep-final {
            background: linear-gradient(180deg, #fef9e7, #fef4d4) !important;
            color: transparent !important;
            font-size: 0 !important;
        }


        /* Activity row styling - Soft Gray */
        tbody th {
            background: linear-gradient(180deg, #f3f4f6, #e5e7eb) !important;
            font-size: 0.95rem !important;
            color: #000000 !important;
            font-weight: 700 !important;
            display: table-cell !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Ensure all tbody rows are visible */
        tbody tr {
            display: table-row !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 50px !important;
            height: auto !important;
        }
        
        /* Ensure Mesyuarat row (first tbody row) is visible */
        tbody tr:first-child,
        tbody tr:first-child th,
        tbody tr:first-child td {
            display: table-cell !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 55px !important;
            height: auto !important;
        }
        
        tbody tr:first-child {
            display: table-row !important;
        }
        
        tbody tr:first-child th {
            background: linear-gradient(180deg, #f3f4f6, #e5e7eb) !important;
            font-size: 0.95rem !important;
            font-weight: 700 !important;
            color: #000000 !important;
            padding: 16px 20px !important;
            z-index: 3 !important;
        }
        
        tbody tr:first-child td {
            z-index: 1 !important;
        }
        
        /* Grey background for Mesyuarat row Tindakan and Status cells */
        tbody tr:first-child td:nth-child(2),
        tbody tr:first-child td:nth-child(3) {
            background: linear-gradient(180deg, #e5e7eb, #d1d5db) !important;
            font-weight: 600 !important;
            border: 1px solid #9ca3af !important;
        }

        /* Empty cell */
        td.empty {
            background: #ffffff;
        }

        tbody tr:hover td:not(.weekend):not(.current-date) {
            background: #f8fafc;
        }

        /* Professional animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            animation: fadeIn 0.6s ease;
        }

        .calendar-container {
            animation: fadeIn 0.8s ease 0.2s backwards;
        }

        /* Table cell borders for better definition */
        table {
            border-radius: 0;
        }

        th:first-child,
        td:first-child {
            border-left: none;
        }

        th:last-child,
        td:last-child {
            border-right: none;
        }

        thead tr:first-child th {
            border-top: none;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        /* Professional focus styles for accessibility */
        a:focus,
        button:focus {
            outline: 3px solid var(--accent-blue);
            outline-offset: 2px;
        }

        /* Responsive for mobile */
        @media (max-width: 768px) {
            .page-container {
                padding: 0 12px 60px;
            }

            .page-header {
                padding: 24px 20px;
                border-radius: 16px;
            }

            .page-header h1 {
                font-size: 1.5rem;
            }

            th, td {
                padding: 10px 6px;
                min-width: 80px;
                max-width: 200px;
                height: auto;
                font-size: 0.85rem;
            }
            
            /* Make event boxes wider on mobile */
            td.has-calendar-event {
                min-width: 120px !important;
                max-width: 180px !important;
                width: auto !important;
                padding: 8px 6px 30px 6px !important;
            }
            
            /* Event text in mobile */
            .has-calendar-event .event-text-span {
                font-size: 0.75rem !important;
                line-height: 1.4 !important;
                padding: 3px !important;
            }

            thead th:first-child,
            tbody th:first-child {
                min-width: 95px;
                font-size: 0.8rem;
                padding-left: 8px;
            }

            thead tr:first-child th:nth-child(2),
            thead tr:nth-child(2) th:nth-child(2),
            tbody td:nth-child(2) {
                left: 95px;
                min-width: 85px;
                font-size: 0.75rem;
            }

            thead tr:first-child th:nth-child(3),
            thead tr:nth-child(2) th:nth-child(3),
            tbody td:nth-child(3) {
                left: 180px;
                min-width: 75px;
                font-size: 0.75rem;
            }
            
            /* Make Mesyuarat row Tindakan and Status sticky on mobile */
            tbody tr:first-child td:nth-child(2) {
                position: sticky !important;
                left: 95px !important;
                z-index: 2 !important;
                background: linear-gradient(180deg, #e5e7eb, #d1d5db) !important;
            }
            
            tbody tr:first-child td:nth-child(3) {
                position: sticky !important;
                left: 180px !important;
                z-index: 2 !important;
                background: linear-gradient(180deg, #e5e7eb, #d1d5db) !important;
            }

            thead tr:nth-child(2) th {
                top: 35px;
            }

            .calendar-wrapper {
                padding: 12px;
            }

            .calendar-title {
                padding: 12px 16px;
                flex-direction: column;
                gap: 12px;
            }

            .calendar-tabs {
                width: 100%;
                justify-content: center;
            }

            .calendar-tab {
                font-size: 0.8rem;
                padding: 0.5rem 0.875rem;
                min-height: 40px;
            }

            .legend {
                gap: 16px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .legend-item {
                font-size: 0.8rem;
            }

            .zoom-controls {
                padding: 6px 12px;
                gap: 6px;
            }

            .zoom-btn {
                padding: 5px 8px;
            }

            .zoom-display {
                font-size: 0.75rem;
                min-width: 45px;
            }

            .zoom-reset {
                font-size: 0.7rem;
                padding: 5px 10px;
            }

            .legend-box {
                width: 28px;
                height: 20px;
            }

            .footer-watermark {
                font-size: 0.35rem;
            }
        }

        /* Professional Print styles */
        @media print {
            body {
                background: white;
            }

            .page-container {
                padding: 0 20px 20px;
            }

            .page-header {
                background: linear-gradient(135deg, var(--secondary-blue) 0%, var(--primary-blue) 100%);
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .calendar-wrapper {
                overflow: visible;
                padding: 10px;
            }
            
            table {
                min-width: 100%;
                page-break-inside: auto;
            }

            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }

            .event-cell,
            .weekend,
            .current-date,
            thead th {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

        }

        .legend {
            display: flex;
            gap: 32px;
            flex-wrap: wrap;
            margin: 0;
            padding: 0;
            background: transparent;
            border-radius: 0;
            border: none;
        }

        .zoom-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            background: #ffffff;
            padding: 8px 16px;
            border-radius: 8px;
            border: 2px solid #d1d5db;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .zoom-btn {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
        }

        .zoom-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .zoom-btn:active {
            transform: translateY(0);
        }

        .zoom-btn svg {
            color: #374151;
        }

        .zoom-display {
            font-size: 0.875rem;
            font-weight: 700;
            color: #1f2937;
            min-width: 50px;
            text-align: center;
        }

        .zoom-reset {
            font-size: 0.75rem;
            padding: 6px 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .legend-box {
            width: 36px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            box-shadow: var(--shadow-sm);
        }

        .legend-box.event {
            background: linear-gradient(135deg, #93c5fd, #bfdbfe);
        }

        .legend-box.current {
            background: linear-gradient(135deg, #a5f3fc, #67e8f9);
        }

        .legend-box.weekend {
            background: linear-gradient(180deg, #fef9e7, #fef4d4);
            border-color: #fde68a;
        }

        /* Footer watermark */
        .footer-watermark {
            text-align: right;
            padding: 20px 24px;
            font-size: 0.375rem;
            color: var(--text-muted);
            margin-top: 24px;
            font-weight: 500;
            letter-spacing: 0.05em;
        }

        /* Calendar Tabs - Standard Checklist Style */
        .calendar-tabs {
            display: flex;
            gap: 0.5rem;
            margin-right: auto;
        }
        
        .calendar-tab {
            padding: 0.625rem 1.25rem;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(102, 126, 234, 0.2);
            user-select: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            outline: none;
        }
        
        .calendar-tab:hover {
            color: #667eea;
            background: #e0e7ff;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }
        
        .calendar-tab:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .calendar-tab.active {
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transform: translateY(-2px);
        }
        
        .calendar-tab.active:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
        }
        
        .calendar-tab svg {
            width: 1rem;
            height: 1rem;
            transition: transform 0.3s;
        }
        
        .calendar-tab:hover svg {
            transform: scale(1.1);
        }
        
        .calendar-tab.active svg {
            color: white;
        }

        /* Month content visibility */
        .month-content {
            display: none;
        }

        .month-content.active {
            display: block;
        }

        .calendar-container {
            position: relative;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: all 0.2s;
        }

        .close:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 2rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        .event-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .event-item {
            background: #f8fafc;
            padding: 1.25rem;
            border-radius: 8px;
            border-left: 4px solid #4f46e5;
            transition: all 0.2s;
        }

        .event-item:hover {
            background: #f1f5f9;
            transform: translateX(4px);
        }

        .event-item-title {
            font-weight: 600;
            font-size: 1rem;
            color: #1e293b;
            flex: 1;
        }

        .event-item-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .status-completed {
            background: #dcfce7;
            color: #166534;
        }

        .status-in-progress {
            background: #fef3c7;
            color: #92400e;
        }

        .status-not-started {
            background: #fee2e2;
            color: #991b1b;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #334155;
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .event-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        /* Editable indicator for super admin */
        .editable-cell {
            cursor: pointer;
            position: relative;
        }

        .editable-cell:hover {
            background: rgba(79, 70, 229, 0.05) !important;
        }

        .editable-label {
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .editable-label:hover {
            background: rgba(79, 70, 229, 0.1);
        }

        .no-events-msg {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-style: italic;
        }

        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="top-bar">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <h1>Jangka Masa HP105</h1>
            </div>
            <a href="index.html" class="home-link">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                Home
            </a>
        </div>

        <div class="calendar-container">
            <div class="calendar-title">
                <div class="calendar-tabs">
                    <button class="calendar-tab active" onclick="switchMonth('dec')" id="tab-dec">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Disember 2025</span>
                    </button>
                    <button class="calendar-tab" onclick="switchMonth('jan')" id="tab-jan">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Januari 2026</span>
                    </button>
                </div>
                
                <div class="zoom-controls">
                    <button onclick="zoomOut()" class="zoom-btn" title="Zoom Out">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                            <line x1="8" y1="11" x2="14" y2="11"></line>
                        </svg>
                    </button>
                    <span class="zoom-display" id="zoomDisplay">100%</span>
                    <button onclick="zoomIn()" class="zoom-btn" title="Zoom In">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21l-4.35-4.35"></path>
                            <line x1="11" y1="8" x2="11" y2="14"></line>
                            <line x1="8" y1="11" x2="14" y2="11"></line>
                        </svg>
                    </button>
                    <button onclick="zoomReset()" class="zoom-btn zoom-reset" title="Reset Zoom">Reset</button>
                </div>
                
            </div>
            <div class="calendar-wrapper" id="calendarWrapper">
                <!-- December 2025 Content -->
                <div class="month-content active" id="month-dec">
                    <table>
                        <thead>
                            <tr>
                                <th>Hari</th>
                                <th class="day-name"></th>
                                <th class="day-name"></th>
                                <th class="day-name">I</th>
                                <th class="day-name">S</th>
                                <th class="day-name">R</th>
                                <th class="day-name">K</th>
                                <th class="day-name weekend">J</th>
                                <th class="day-name">S</th>
                                <th class="day-name weekend">A</th>
                                <th class="day-name">I</th>
                                <th class="day-name">S</th>
                                <th class="day-name">R</th>
                                <th class="day-name">K</th>
                                <th class="day-name weekend">J</th>
                                <th class="day-name">S</th>
                                <th class="day-name weekend">A</th>
                                <th class="day-name">I</th>
                                <th class="day-name">S</th>
                                <th class="day-name">R</th>
                                <th class="day-name">K</th>
                                <th class="day-name weekend">J</th>
                                <th class="day-name">S</th>
                                <th class="day-name weekend">A</th>
                                <th class="day-name">I</th>
                                <th class="day-name">S</th>
                                <th class="day-name">R</th>
                                <th class="day-name">K</th>
                                <th class="day-name weekend">J</th>
                                <th class="day-name">S</th>
                                <th class="day-name weekend">A</th>
                                <th class="day-name">I</th>
                                <th class="day-name">S</th>
                                <th class="day-name">R</th>
                            </tr>
                            <tr>
                                <th>Tarikh</th>
                                <th>Tindakan</th>
                                <th>Status</th>
                                <th class="date-num">1</th>
                                <th class="date-num">2</th>
                                <th class="date-num">3</th>
                                <th class="date-num">4</th>
                                <th class="date-num weekend">5</th>
                                <th class="date-num">6</th>
                                <th class="date-num weekend">7</th>
                                <th class="date-num">8</th>
                                <th class="date-num">9</th>
                                <th class="date-num">10</th>
                                <th class="date-num">11</th>
                                <th class="date-num weekend">12</th>
                                <th class="date-num">13</th>
                                <th class="date-num weekend">14</th>
                                <th class="date-num">15</th>
                                <th class="date-num">16</th>
                                <th class="date-num">17</th>
                                <th class="date-num">18</th>
                                <th class="date-num weekend">19</th>
                                <th class="date-num">20</th>
                                <th class="date-num weekend">21</th>
                                <th class="date-num">22</th>
                                <th class="date-num">23</th>
                                <th class="date-num">24</th>
                                <th class="date-num">25</th>
                                <th class="date-num weekend">26</th>
                                <th class="date-num">27</th>
                                <th class="date-num weekend">28</th>
                                <th class="date-num">29</th>
                                <th class="date-num">30</th>
                                <th class="date-num">31</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Add December activities here - for now showing empty template -->
                            <tr>
                                <th>Mesyuarat</th>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                            </tr>
                            <tr>
                                <th>Majlis Keugamaan</th>
                                <td>DSP Aimi</td>
                                <td></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                            </tr>
                            <tr>
                                <th>Bergambar Ramai untuk AJK HP105</th>
                                <td></td>
                                <td></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="weekend"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                                <td class="empty"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- January 2026 Content -->
                <div class="month-content" id="month-jan">
            <table>
                <thead>
                    <!-- Day names row -->
                        <tr>
                        <th>Hari</th>
                        <th class="day-name"></th>
                        <th class="day-name"></th>
                        <th class="day-name">K</th>
                        <th class="day-name weekend">J</th>
                        <th class="day-name">S</th>
                        <th class="day-name weekend">A</th>
                        <th class="day-name">I</th>
                        <th class="day-name">S</th>
                        <th class="day-name">R</th>
                        <th class="day-name">K</th>
                        <th class="day-name weekend">J</th>
                        <th class="day-name">S</th>
                        <th class="day-name weekend">A</th>
                        <th class="day-name">I</th>
                        <th class="day-name">S</th>
                        <th class="day-name">R</th>
                        <th class="day-name current-date">K</th>
                        <th class="day-name weekend">J</th>
                        <th class="day-name">S</th>
                        <th class="day-name weekend">A</th>
                        <th class="day-name">I</th>
                        <th class="day-name">S</th>
                        <th class="day-name">R</th>
                        <th class="day-name">K</th>
                        <th class="day-name weekend">J</th>
                        <th class="day-name">S</th>
                        <th class="day-name weekend">A</th>
                        <th class="day-name">I</th>
                        <th class="day-name">S</th>
                        <th class="day-name">R</th>
                        <th class="day-name">K</th>
                        <th class="day-name weekend">J</th>
                        <th class="day-name">S</th>
                    </tr>
                    <!-- Dates row -->
                    <tr>
                        <th>Tarikh</th>
                        <th>Tindakan</th>
                        <th>Status</th>
                        <th class="date-num">1</th>
                        <th class="date-num weekend">2</th>
                        <th class="date-num">3</th>
                        <th class="date-num weekend">4</th>
                        <th class="date-num">5</th>
                        <th class="date-num">6</th>
                        <th class="date-num">7</th>
                        <th class="date-num">8</th>
                        <th class="date-num weekend">9</th>
                        <th class="date-num">10</th>
                        <th class="date-num weekend">11</th>
                        <th class="date-num">12</th>
                        <th class="date-num">13</th>
                        <th class="date-num">14</th>
                        <th class="date-num current-date">15</th>
                        <th class="date-num weekend">16</th>
                        <th class="date-num">17</th>
                        <th class="date-num weekend">18</th>
                        <th class="date-num">19</th>
                        <th class="date-num">20</th>
                        <th class="date-num">21</th>
                        <th class="date-num">22</th>
                        <th class="date-num weekend">23</th>
                        <th class="date-num">24</th>
                        <th class="date-num weekend">25</th>
                        <th class="date-num">26</th>
                        <th class="date-num">27</th>
                        <th class="date-num">28</th>
                        <th class="date-num">29</th>
                        <th class="date-num weekend">30</th>
                        <th class="date-num">31</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Mesyuarat -->
                    <tr>
                        <th>Mesyuarat</th>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- Perbarisan -->
                    <tr>
                        <th>Perbarisan</th>
                        <td>S.SUPT Matnoor</td>
                        <td></td>
                        <td class="prep-early" title="Latihan Perbarisan">Latihan 1</td>
                        <td class="weekend"></td>
                        <td class="prep-early" title="Latihan Perbarisan">Latihan 2</td>
                        <td class="weekend"></td>
                        <td class="prep-mid" title="Latihan Perbarisan">Latihan 3</td>
                        <td class="prep-mid" title="Latihan Perbarisan">Latihan 4</td>
                        <td class="prep-mid" title="Latihan Perbarisan">Latihan 5</td>
                        <td class="prep-mid" title="Latihan Perbarisan">Latihan 6</td>
                        <td class="weekend"></td>
                        <td class="prep-final" title="Latihan Perbarisan">Latihan 7</td>
                        <td class="weekend"></td>
                        <td class="prep-final" title="Latihan Perbarisan">Latihan 8</td>
                        <td class="prep-final" title="Latihan Perbarisan">Latihan 9</td>
                        <td class="prep-final" title="Latihan Perbarisan">Latihan 10</td>
                        <td class="current-date main-event" title="Majlis Perbarisan HP105">PERBARISAN</td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- Makan beradat -->
                    <tr>
                        <th>Makan beradat</th>
                        <td>SUPT PG OMAR</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="prep-final" title="Latihan Makan Beradat">Latihan</td>
                        <td class="empty"></td>
                        <td class="current-date main-event" title="Majlis Makan Beradat">MAKAN BERADAT</td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- BM -->
                    <tr>
                        <th>BM</th>
                        <td>OCPD BM</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="event-cell" title="BM Activity"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- TT -->
                    <tr>
                        <th>TT</th>
                        <td>OCPD TT</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- KB -->
                    <tr>
                        <th>KB</th>
                        <td>OCPD KB</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="event-cell" title="KB Activity"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- TEMB -->
                    <tr>
                        <th>TEMB</th>
                        <td>OCPD TEMB</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- Pameran -->
                    <tr>
                        <th>Pameran</th>
                        <td>SUPT Suzy</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend event-cell" title="Pameran"></td>
                        <td class="event-cell" title="Pameran"></td>
                        <td class="weekend event-cell" title="Pameran"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                    <!-- Majlis Keugamaan -->
                    <tr>
                        <th>Majlis Keugamaan</th>
                        <td>DSP Aimi</td>
                        <td></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="current-date"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend event-cell" title="Majlis Keugamaan"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="empty"></td>
                        <td class="weekend"></td>
                        <td class="empty"></td>
                    </tr>
                </tbody>
            </table>
                </div>
            </div>
        </div>

        <div class="footer-watermark">
            DKH@2025
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Events</h2>
                <span class="close" onclick="closeEventModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="eventList" class="event-list"></div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Event Modal -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addModalTitle">Add Event</h2>
                <span class="close" onclick="closeAddEventModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="eventForm" onsubmit="saveEvent(event)">
                    <div class="form-group">
                        <label>Activity Row</label>
                        <div id="eventActivityDisplay" style="padding: 0.75rem; background: #f3f4f6; border-radius: 0.375rem; font-weight: 600; color: #1f2937; border: 2px solid #d1d5db;">
                            <!-- Activity will be shown here (read-only) -->
                        </div>
                        <input type="hidden" id="eventActivity">
                    </div>
                    <div class="form-group">
                        <label>Event Title *</label>
                        <input type="text" id="eventTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Status *</label>
                        <select id="eventStatus" required>
                            <option value="not-started">Not Started</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="eventDescription" rows="3" placeholder="Enter each item on a new line for numbered list"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddEventModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Event</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Authentication and Permission Check
        function isSuperAdmin() {
            if (!AuthAPI || !AuthAPI.isLoggedIn()) {
                return false;
            }
            const user = AuthAPI.getCurrentUser();
            return user && user.role === 'super_admin';
        }

        // Global variables for event management
        let currentEditMonth = null;
        let currentEditDay = null;
        let currentEditActivity = null;  // NEW: Track which activity row
        let currentEditEventId = null;
        let events = {
            'dec': {},
            'jan': {}
        };

        // Static snapshot fallback events (Dec 2025 & Jan 2026)
        const staticEventsSnapshot = [
            { month: 'dec', day: 3,  title: 'Mesyuarat 04/2025', activity: 'Mesyuarat' },
            { month: 'dec', day: 10, title: 'Mesyuarat 05/2025', activity: 'Mesyuarat' },
            { month: 'dec', day: 17, title: 'Mesyuarat 06/2025', activity: 'Mesyuarat' },
            { month: 'dec', day: 24, title: 'Bergambar Ramai AJK HP105 @ MES Bergambar Ramai untuk AJK HP105', activity: 'Mesyuarat' },
            { month: 'dec', day: 24, title: 'Mesyuarat 07/2025', activity: 'Mesyuarat' },
            { month: 'dec', day: 31, title: 'Mesyuarat 08/2025', activity: 'Mesyuarat' },
            { month: 'jan', day: 3,  title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 5,  title: 'Aktiviti Daerah BM : Kempen Derma Darah @BP BKS BM', activity: 'BM' },
            { month: 'jan', day: 5,  title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 6,  title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 7,  title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 8,  title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 10, title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 12, title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 13, title: 'Raptai Mkn Beradat dgn Dato CP', activity: 'Makan beradat' },
            { month: 'jan', day: 13, title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 14, title: 'Latihan Perbarisan @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 15, title: 'Majlis Makan Beradat @ Mess', activity: 'Makan beradat' },
            { month: 'jan', day: 15, title: 'Majlis Perbarisan HP105 @PTC', activity: 'Perbarisan' },
            { month: 'jan', day: 21, title: 'Aktiviti Daerah Belait : Kempen Derma Darah @Dewan Persidangan KB', activity: 'KB' },
            { month: 'jan', day: 22, title: 'Aktiviti Daerah Temburong : Membersihkan Tanah Perkuburan Islam @TBC', activity: 'TEMB' },
            { month: 'jan', day: 23, title: 'Khutbah sempena HP105 dikeluarkan', activity: 'Majlis Keugamaan' },
            { month: 'jan', day: 24, title: 'Pameran @Stadium Polis Gadong', activity: 'Pameran' },
            { month: 'jan', day: 24, title: 'Aktivit Daerah Temburong : Kempen Derma Darah @TBC', activity: 'TEMB' },
            { month: 'jan', day: 25, title: 'Pameran @Stadium Polis Gadong', activity: 'Pameran' },
            { month: 'jan', day: 27, title: 'Aktiviti Daerah Tutong : Kejohanan Bola Sepak', activity: 'TT' }
        ];

        // Month names mapping
        const monthNames = {
            'dec': 'Disember',
            'jan': 'Januari'
        };

        // Map calendar event titles to timeline activity rows
        function mapEventToActivity(eventTitle) {
            const title = (eventTitle || '').toLowerCase();
            
            // Mapping rules based on keywords in event title
            // ORDER MATTERS - More specific checks first!
            if (title.includes('perbarisan')) return 'Perbarisan';
            if (title.includes('makan beradat') || title.includes('mkn beradat')) return 'Makan beradat';
            
            // District-specific checks (check specific district names first)
            if (title.includes('daerah tutong') || title.includes('tutong')) return 'TT';
            if (title.includes('daerah bm') || title.includes('bp bks') || title.includes('brunei muara')) return 'BM';
            if (title.includes('daerah belait') || title.includes('belait')) return 'KB';
            if (title.includes('daerah temburong') || title.includes('temburong')) return 'TEMB';
            // Note: Removed 'tbc' from TEMB check as it conflicts with "@TBC" (To Be Confirmed)
            
            if (title.includes('pameran')) return 'Pameran';
            if (title.includes('keugamaan') || title.includes('khutbah')) return 'Majlis Keugamaan';
            if (title.includes('gambar') || title.includes('ajk')) return 'Bergambar Ramai untuk AJK HP105';
            if (title.includes('mesyuarat')) return 'Mesyuarat';
            
            // Default fallback
            return 'Mesyuarat';
        }

        // Load events from database (READ ONLY - imports from calendar)
        async function loadDatabaseEvents() {
            try {
                const result = await CalendarEventsAPI.getAll();
                console.log('📥 Importing calendar events to timeline...');
                console.log('Raw database result:', result);
                
                if (result && result.success && result.data) {
                    // Clear existing events
                    events = { 'dec': {}, 'jan': {} };
                    
                    // Organize events by month -> activity -> day
                    result.data.forEach(event => {
                        console.log('Processing event:', event);
                        
                        // Get month and day
                        const month = event.month || event.event_month;
                        const day = parseInt(event.day || event.event_day);
                        
                        // Get event title
                        const eventTitle = event.event_title || event.title || 'Untitled Event';
                        
                        // Use stored activity if available, otherwise map from title
                        const activity = event.activity || mapEventToActivity(eventTitle);
                        
                        // Get event details
                        let status = event.status || event.event_time || 'not-started'; // Try status first, fallback to event_time for old data
                        
                        // Normalize status - if it's not a valid status value, set to 'not-started'
                        const validStatuses = ['completed', 'in-progress', 'not-started'];
                        if (!validStatuses.includes(status)) {
                            console.log(`⚠️ Invalid status "${status}" for event "${eventTitle}", setting to "not-started"`);
                            status = 'not-started';
                        }
                        
                        const description = event.description || event.venue || ''; // Get description or venue for old data
                        const id = event.id || event.event_id;
                        
                        if (!month || !day) {
                            console.warn('Invalid event data - missing month or day:', event);
                            return;
                        }
                        
                        // Initialize nested structure: month -> activity -> day -> events
                        if (!events[month]) {
                            events[month] = {};
                        }
                        if (!events[month][activity]) {
                            events[month][activity] = {};
                        }
                        if (!events[month][activity][day]) {
                            events[month][activity][day] = [];
                        }
                        
                        events[month][activity][day].push({
                            id: id,
                            title: eventTitle,
                            status: status,
                            description: description,
                            activity: activity
                        });
                        
                        console.log(`✓ Imported: ${eventTitle} → ${activity} (${month}/${day})`);
                    });
                    
                    console.log('✅ Calendar events imported successfully!');
                    console.log('Events structure:', events);
                } else {
                    console.error('❌ Invalid result from API:', result);
                }
            } catch (error) {
                console.error('❌ Error loading events:', error);
            }
        }

        // Handle cell click - show events or add new for super admin
        function handleCellClick(month, day, activity, cell) {
            if (!isSuperAdmin()) {
                // For regular users, only show events if they exist
                if (events[month] && events[month][activity] && events[month][activity][day] && events[month][activity][day].length > 0) {
                    showEventsModal(month, day, activity);
                }
                return;
            }

            // Super admin can add/view events
            currentEditMonth = month;
            currentEditDay = day;
            currentEditActivity = activity;
            
            // Check if there are existing events
            const hasEvents = events[month] && events[month][activity] && events[month][activity][day] && events[month][activity][day].length > 0;
            
            // Single click: Show events modal (with option to add more)
            // This shows all events + an "Add Another Event" button
            if (hasEvents) {
                showEventsModal(month, day, activity);
            } else {
                // No events: Directly open add event modal for quick adding
                showAddEventModal(month, day, activity);
            }
        }

        // Show events modal
        function showEventsModal(month, day, activity) {
            const modal = document.getElementById('eventModal');
            const eventList = document.getElementById('eventList');
            const modalTitle = document.getElementById('modalTitle');
            
            modalTitle.textContent = `Events - ${activity} - ${day} ${monthNames[month]} ${month === 'jan' ? '2026' : '2025'}`;
            eventList.innerHTML = '';
            
            const dayEvents = events[month] && events[month][activity] && events[month][activity][day] ? events[month][activity][day] : [];
            
            console.log('Showing events for', month, activity, day, ':', dayEvents);
            
            if (dayEvents.length === 0) {
                eventList.innerHTML = '<div class="no-events-msg">No events for this date</div>';
            } else {
                dayEvents.forEach((event, index) => {
                    console.log('Rendering event:', event);
                    
                    const eventItem = document.createElement('div');
                    eventItem.className = 'event-item';
                    
                    // Safely get event properties with fallbacks
                    const title = event.title || 'Untitled Event';
                    const status = event.status || 'not-started';
                    const description = event.description || '';
                    const eventId = event.id || 0;
                    
                    const statusClass = `status-${status}`;
                    const statusText = {
                        'completed': 'Completed',
                        'in-progress': 'In Progress',
                        'not-started': 'Not Started'
                    }[status] || 'Not Started';
                    
                    // Format description as numbered list if it contains line breaks or numbered items
                    let formattedDescription = '';
                    if (description) {
                        const lines = description.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                        
                        // Filter out lines that start with "Time:" or "Venue:" metadata
                        const contentLines = lines.filter(line => {
                            const lowerLine = line.toLowerCase();
                            // Skip lines that are just metadata (Time: ... | Venue: ...)
                            if (lowerLine.startsWith('time:') || lowerLine.startsWith('venue:')) {
                                return false;
                            }
                            // Skip lines that look like "Time: Something | Venue: Something"
                            if (lowerLine.includes('time:') && lowerLine.includes('venue:')) {
                                return false;
                            }
                            return true;
                        });
                        
                        if (contentLines.length > 1) {
                            formattedDescription = '<ol style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem; margin-left: 1.5rem; line-height: 1.6;">';
                            contentLines.forEach((line, index) => {
                                // Remove existing number prefix like "1)" or "1."
                                const cleanLine = line.replace(/^\d+[\.\)]\s*/, '');
                                
                                // Add status icon based on item number (1-indexed)
                                const itemNumber = index + 1;
                                let icon = '';
                                
                                // Item 3 gets green checkmark (completed), others get yellow circle (pending)
                                if (itemNumber === 3) {
                                    icon = '<span style="display: inline-block; margin-left: 8px; font-size: 1rem;">✅</span>';
                                } else {
                                    icon = '<span style="display: inline-block; margin-left: 8px; font-size: 1rem;">🟡</span>';
                                }
                                
                                formattedDescription += `<li>${cleanLine}${icon}</li>`;
                            });
                            formattedDescription += '</ol>';
                        } else if (contentLines.length === 1) {
                            formattedDescription = `<div style="color: #64748b; font-size: 0.875rem; margin-top: 0.25rem;">${contentLines[0]}</div>`;
                        } else {
                            // If all lines were filtered out, show the original description
                            formattedDescription = `<div style="color: #64748b; font-size: 0.875rem; margin-top: 0.25rem;">${description}</div>`;
                        }
                    }
                    
                    let actionsHtml = '';
                    if (isSuperAdmin()) {
                        actionsHtml = `
                            <div class="event-actions">
                                <button class="btn btn-primary" onclick="editEventClick('${month}', ${day}, '${activity}', ${index})">✏️ Edit</button>
                                <button class="btn btn-danger" onclick="deleteEventClick('${month}', ${day}, '${activity}', ${index}, ${eventId})">🗑️ Delete</button>
                            </div>
                        `;
                    }
                    
                    eventItem.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                            <div class="event-item-title" style="margin: 0;">${title}</div>
                            <span class="event-item-status ${statusClass}">${statusText}</span>
                        </div>
                        ${formattedDescription}
                        ${actionsHtml}
                    `;
                    
                    eventList.appendChild(eventItem);
                });

                    // Merge static fallback events to ensure visibility (Dec/Jan)
                    staticEventsSnapshot.forEach(evt => {
                        const month = evt.month;
                        const day = parseInt(evt.day);
                        const title = evt.title || 'Untitled Event';
                        const activity = evt.activity || mapEventToActivity(title);
                        if (!month || !day || !activity) return;
                        
                        if (!events[month]) events[month] = {};
                        if (!events[month][activity]) events[month][activity] = {};
                        if (!events[month][activity][day]) events[month][activity][day] = [];
                        
                        events[month][activity][day].push({
                            id: `static-${month}-${day}-${events[month][activity][day].length}`,
                            title,
                            status: 'not-started',
                            description: ''
                        });
                    });
            }
            
            // Add "Add Another Event" button for super admin
            if (isSuperAdmin()) {
                const addBtn = document.createElement('button');
                addBtn.className = 'btn btn-primary';
                addBtn.style.width = '100%';
                addBtn.style.marginTop = '1rem';
                addBtn.textContent = '➕ Add Another Event';
                addBtn.onclick = () => {
                    closeEventModal();
                    showAddEventModal(month, day, activity);
                };
                eventList.appendChild(addBtn);
            }
            
            modal.style.display = 'block';
        }

        // Show add event modal
        function showAddEventModal(month, day, activity, existingEvent = null) {
            const modal = document.getElementById('addEventModal');
            const modalTitle = document.getElementById('addModalTitle');
            const form = document.getElementById('eventForm');
            
            currentEditMonth = month;
            currentEditDay = day;
            currentEditActivity = activity;
            currentEditEventId = existingEvent ? (existingEvent.id || null) : null;
            
            console.log('Show add/edit modal:', { month, day, activity, existingEvent, currentEditEventId });
            
            // Set activity (from the row that was clicked)
            document.getElementById('eventActivity').value = activity;
            document.getElementById('eventActivityDisplay').textContent = activity;
            
            if (existingEvent) {
                modalTitle.textContent = `Edit Event - ${day} ${monthNames[month]} ${month === 'jan' ? '2026' : '2025'}`;
                document.getElementById('eventTitle').value = existingEvent.title || '';
                document.getElementById('eventStatus').value = existingEvent.status || 'not-started';
                document.getElementById('eventDescription').value = existingEvent.description || '';
            } else {
                modalTitle.textContent = `Add Event - ${day} ${monthNames[month]} ${month === 'jan' ? '2026' : '2025'}`;
                form.reset();
                // Reset the activity display after form.reset()
                document.getElementById('eventActivity').value = activity;
                document.getElementById('eventActivityDisplay').textContent = activity;
            }
            
            modal.style.display = 'block';
        }

        // Edit event click
        function editEventClick(month, day, activity, index) {
            const event = events[month][activity][day][index];
            closeEventModal();
            showAddEventModal(month, day, activity, event);
        }

        // Delete event click
        async function deleteEventClick(month, day, activity, index, eventId) {
            if (!confirm('Are you sure you want to delete this event?')) {
                return;
            }
            
            try {
                const result = await CalendarEventsAPI.delete(eventId);
                if (result && result.success) {
                    // Remove from local array
                    events[month][activity][day].splice(index, 1);
                    if (events[month][activity][day].length === 0) {
                        delete events[month][activity][day];
                    }
                    
                    // Refresh modal
                    closeEventModal();
                    
                    // Update blue highlighting
                    setTimeout(() => {
                        updateCalendarEventIndicators();
                    }, 200);
                    
                    alert('✅ Event deleted successfully!');
                } else {
                    alert('❌ Failed to delete event: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting event:', error);
                alert('❌ Failed to delete event');
            }
        }

        // Save event (add or edit)
        async function saveEvent(e) {
            e.preventDefault();
            
            const selectedActivity = document.getElementById('eventActivity').value;
            const title = document.getElementById('eventTitle').value.trim();
            const status = document.getElementById('eventStatus').value;
            const description = document.getElementById('eventDescription').value.trim();
            
            if (!selectedActivity) {
                alert('Please select an activity row');
                return;
            }
            
            if (!title) {
                alert('Please enter an event title');
                return;
            }
            
            // Use the manually selected activity instead of auto-mapped one
            currentEditActivity = selectedActivity;
            
            console.log('Saving event:', { title, status, description, month: currentEditMonth, day: currentEditDay, activity: currentEditActivity, id: currentEditEventId });
            
            try {
                let result;
                if (currentEditEventId) {
                    // Update existing event - Pass status, title, description, and activity
                    console.log('Updating event ID:', currentEditEventId);
                    result = await CalendarEventsAPI.update(currentEditEventId, status, title, description, currentEditActivity);
                    console.log('Update result:', result);
                } else {
                    // Create new event - Pass status, title, description, and activity
                    console.log('Creating new event for', currentEditMonth, currentEditDay, currentEditActivity);
                    result = await CalendarEventsAPI.create(currentEditMonth, currentEditDay, status, title, description, currentEditActivity);
                    console.log('Create result:', result);
                }
                
                if (result && result.success) {
                    // Reload events from database
                    console.log('Reloading events from database...');
                    await loadDatabaseEvents();
                    
                    closeAddEventModal();
                    
                    // Update blue highlighting
                    setTimeout(() => {
                        updateCalendarEventIndicators();
                    }, 200);
                    
                    alert('✅ Event saved successfully!');
                    
                    // Show events modal
                    setTimeout(() => {
                        showEventsModal(currentEditMonth, currentEditDay, currentEditActivity);
                    }, 300);
                } else {
                    console.error('Save failed:', result);
                    alert('❌ Failed to save event: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving event:', error);
                alert('❌ Failed to save event: ' + error.message);
            }
        }

        // Close modals
        function closeEventModal() {
            document.getElementById('eventModal').style.display = 'none';
        }

        function closeAddEventModal() {
            document.getElementById('addEventModal').style.display = 'none';
            document.getElementById('eventForm').reset();
            currentEditEventId = null;
        }

        // Close modal on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeEventModal();
                closeAddEventModal();
            }
        }

        // Helper function to make a cell editable
        function makeCellEditable(cell, columnType) {
            cell.classList.add('admin-editable-text');
            cell.title = `Double-click to edit ${columnType}`;
            cell.style.cursor = 'pointer';
            
            // Add visual indicator on hover
            cell.addEventListener('mouseenter', function() {
                if (!this.querySelector('input')) {
                    this.style.backgroundColor = '#f0f9ff';
                    this.style.outline = '1px dashed #3b82f6';
                }
            });
            
            cell.addEventListener('mouseleave', function() {
                if (!this.querySelector('input')) {
                    this.style.backgroundColor = '';
                    this.style.outline = '';
                }
            });
            
            cell.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                
                const currentText = this.textContent.trim();
                const input = document.createElement('input');
                input.type = 'text';
                input.value = currentText;
                input.className = 'inline-text-edit';
                input.style.width = '100%';
                input.style.padding = '8px';
                input.style.border = '2px solid #3b82f6';
                input.style.borderRadius = '4px';
                input.style.fontSize = '0.875rem';
                input.style.backgroundColor = '#ffffff';
                
                this.textContent = '';
                this.appendChild(input);
                this.style.backgroundColor = '#dbeafe';
                this.style.outline = '2px solid #3b82f6';
                input.focus();
                input.select();
                
                // Save on Enter
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        saveCellContent(this, input.value, currentText);
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        this.textContent = currentText;
                        this.style.backgroundColor = '';
                        this.style.outline = '';
                    }
                });
                
                // Save on blur (click outside)
                input.addEventListener('blur', () => {
                    setTimeout(() => {
                        if (this.querySelector('input')) {
                            saveCellContent(this, input.value, currentText);
                        }
                    }, 100);
                });
            });
        }
        
        // Save cell content to database
        async function saveCellContent(cell, newValue, oldValue) {
            if (newValue === oldValue) {
                cell.textContent = oldValue;
                cell.style.backgroundColor = '';
                cell.style.outline = '';
                return;
            }
            
            cell.textContent = newValue;
            cell.style.backgroundColor = '#fef3c7'; // Yellow flash (saving...)
            cell.style.outline = '';
            
            // Get row and activity info
            const row = cell.closest('tr');
            const activityHeader = row.querySelector('th');
            const activityName = activityHeader ? activityHeader.textContent.trim() : '';
            const cellIndex = Array.from(row.children).indexOf(cell);
            
            // Determine if this is Tindakan (index 1) or Status (index 2)
            const columnType = cellIndex === 1 ? 'tindakan' : 'status';
            
            // Get current month tab
            const activeMonth = document.querySelector('.calendar-tab.active').id.replace('tab-', '');
            
            // Get current values for this row
            const cells = row.querySelectorAll('td');
            const currentTindakan = cells[0] ? cells[0].textContent.trim() : '';
            const currentStatus = cells[1] ? cells[1].textContent.trim() : '';
            
            console.log(`💾 Saving to database: ${activeMonth}/${activityName}/${columnType} = "${newValue}"`);
            
            try {
                // Save to database
                const result = await TimelineMetadataAPI.save(
                    activeMonth, 
                    activityName, 
                    columnType === 'tindakan' ? newValue : currentTindakan,
                    columnType === 'status' ? newValue : currentStatus
                );
                
                if (result && result.success) {
                    // Success - green flash
                    cell.style.backgroundColor = '#d1fae5';
                    console.log(`✅ Saved to database: ${activeMonth}/${activityName}/${columnType} = "${newValue}"`);
                } else {
                    // Error - red flash
                    cell.style.backgroundColor = '#fee2e2';
                    console.error('Failed to save:', result);
                    alert('❌ Failed to save. Please try again.');
                }
            } catch (error) {
                // Error - red flash
                cell.style.backgroundColor = '#fee2e2';
                console.error('Error saving to database:', error);
                alert('❌ Error saving. Please check your connection.');
            }
            
            // Flash then fade
            setTimeout(() => {
                cell.style.backgroundColor = '';
            }, 1000);
        }
        
        // Load saved Tindakan and Status values from database
        async function loadSavedCellValues() {
            const activeMonth = document.querySelector('.calendar-tab.active').id.replace('tab-', '');
            
            console.log(`📥 Loading Tindakan/Status from database for ${activeMonth}...`);
            
            try {
                // Fetch all metadata from database
                const result = await TimelineMetadataAPI.getAll();
                
                if (result && result.success && result.data) {
                    // Filter for current month
                    const monthData = result.data.filter(item => item.month === activeMonth);
                    
                    console.log(`Found ${monthData.length} metadata records for ${activeMonth}`);
                    
                    // Get all activity rows
                    const rows = document.querySelectorAll('tbody tr');
                    
                    rows.forEach(row => {
                        const activityHeader = row.querySelector('th');
                        if (!activityHeader) return;
                        
                        const activityName = activityHeader.textContent.trim();
                        const cells = row.querySelectorAll('td');
                        
                        if (cells.length < 2) return;
                        
                        // Find metadata for this activity
                        const metadata = monthData.find(item => item.activity === activityName);
                        
                        if (metadata) {
                            // Load Tindakan (index 0)
                            if (metadata.tindakan) {
                                cells[0].textContent = metadata.tindakan;
                                console.log(`Loaded ${activityName} Tindakan: "${metadata.tindakan}"`);
                            }
                            
                            // Load Status (index 1)
                            if (metadata.status) {
                                cells[1].textContent = metadata.status;
                                console.log(`Loaded ${activityName} Status: "${metadata.status}"`);
                            }
                        }
                    });
                } else {
                    console.log('No metadata found or error occurred');
                }
            } catch (error) {
                console.error('Error loading metadata from database:', error);
            }
        }
        
        // Handle label editing for super admin
        function makeLabelsEditable() {
            if (!isSuperAdmin()) return;
            
            // Make Tindakan (2nd column) and Status (3rd column) cells editable
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length < 3) return; // Skip rows without enough columns
                
                // Make Tindakan cell (index 0) editable
                const tindakanCell = cells[0];
                if (tindakanCell && !tindakanCell.classList.contains('editable-cell')) {
                    makeCellEditable(tindakanCell, 'Tindakan');
                }
                
                // Make Status cell (index 1) editable
                const statusCell = cells[1];
                if (statusCell && !statusCell.classList.contains('editable-cell')) {
                    makeCellEditable(statusCell, 'Status');
                }
            });
            
            // Make all header labels and activity names editable
            const editableElements = document.querySelectorAll('th, td');
            editableElements.forEach(el => {
                // Skip date number cells and cells that already have event handling
                if (el.classList.contains('editable-cell') || el.dataset.day) {
                    return;
                }
                
                // Skip cells we already made editable above
                if (el.classList.contains('admin-editable-text')) {
                    return;
                }
                
                // Only make text-only cells editable (labels)
                if (el.textContent.trim() && !el.querySelector('input') && !el.querySelector('button')) {
                    el.classList.add('editable-label');
                    el.title = 'Double-click to edit';
                    
                    el.addEventListener('dblclick', function() {
                        const currentText = this.textContent;
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = currentText;
                        input.style.width = '100%';
                        input.style.padding = '4px';
                        input.style.border = '2px solid #4f46e5';
                        input.style.borderRadius = '4px';
                        
                        this.textContent = '';
                        this.appendChild(input);
                        input.focus();
                        input.select();
                        
                        const saveEdit = () => {
                            const newText = input.value.trim();
                            if (newText) {
                                this.textContent = newText;
                            } else {
                                this.textContent = currentText;
                            }
                        };
                        
                        input.addEventListener('blur', saveEdit);
                        input.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                saveEdit();
                            }
                        });
                        input.addEventListener('keydown', function(e) {
                            if (e.key === 'Escape') {
                                this.parentElement.textContent = currentText;
                            }
                        });
                    });
                }
            });
        }

        // Add click handlers to date cells
        function initializeCellHandlers() {
            console.log('Initializing cell handlers...');
            const cells = document.querySelectorAll('td');
            let cellCount = 0;
            
            cells.forEach(cell => {
                // Find cells that represent dates (not headers, not status/tindakan columns)
                const parent = cell.parentElement;
                if (!parent) return;
                
                const cellIndex = Array.from(parent.children).indexOf(cell);
                // Skip first few columns (Tarikh, Tindakan, Status, activity name)
                if (cellIndex <= 3) return;
                
                // Get day number from header
                const table = cell.closest('table');
                if (!table) return;
                
                const thead = table.querySelector('thead');
                if (!thead) return;
                
                const dayRow = thead.querySelector('tr:nth-child(2)');
                if (!dayRow) return;
                
                const dayCell = dayRow.children[cellIndex];
                if (!dayCell) return;
                
                const day = parseInt(dayCell.textContent.trim());
                if (isNaN(day)) return;
                
                // Determine month from table parent
                const monthContainer = table.closest('.month-content');
                if (!monthContainer) return;
                
                const month = monthContainer.id.replace('month-', '');
                
                // Get activity name from the first <th> in the row
                const activityHeader = parent.querySelector('th');
                const activity = activityHeader ? activityHeader.textContent.trim() : 'General';
                
                // Mark cell as editable and add handler
                cell.classList.add('editable-cell');
                cell.dataset.month = month;
                cell.dataset.day = day;
                cell.dataset.activity = activity;
                
                cellCount++;
                console.log(`Cell initialized: ${month}/${activity}/${day}`);
                
                if (isSuperAdmin()) {
                    cell.title = 'Click to add/view events';
                    cell.classList.add('admin-clickable'); // Add class for styling
                }
                
                cell.style.cursor = isSuperAdmin() ? 'pointer' : 'default';
                
                cell.addEventListener('click', function(e) {
                    // Don't trigger if clicking on a button or input
                    if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') {
                        return;
                    }
                    // Don't trigger if cell is being edited
                    if (this.contentEditable === 'true') {
                        return;
                    }
                    handleCellClick(month, day, activity, this);
                });
            });
            
            console.log(`Total cells initialized: ${cellCount}`);
            
            // Update blue highlighting after cell initialization
            setTimeout(() => {
                updateCalendarEventIndicators();
            }, 200);
        }

        // Make cell inline editable
        function makeInlineEditable(cell, month, day, activity) {
            if (!isSuperAdmin()) return;
            
            const originalText = cell.textContent;
            const eventId = cell.dataset.eventId;
            
            // Make editable
            cell.contentEditable = true;
            cell.focus();
            cell.style.outline = '3px solid #3b82f6';
            cell.style.backgroundColor = '#dbeafe';
            
            // Select all text
            const range = document.createRange();
            range.selectNodeContents(cell);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            // Create save/cancel buttons
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'inline-edit-buttons';
            buttonContainer.innerHTML = `
                <button class="inline-save-btn" onclick="saveInlineEdit(this, '${month}', ${day}, '${activity}', '${eventId}')">💾 Save</button>
                <button class="inline-cancel-btn" onclick="cancelInlineEdit(this, '${originalText.replace(/'/g, "\\'")}')">✖ Cancel</button>
            `;
            cell.appendChild(buttonContainer);
            
            // Handle Enter key to save, Escape to cancel
            cell.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const saveBtn = cell.querySelector('.inline-save-btn');
                    if (saveBtn) saveBtn.click();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    const cancelBtn = cell.querySelector('.inline-cancel-btn');
                    if (cancelBtn) cancelBtn.click();
                }
            }, { once: true });
            
            // Prevent cell click from triggering
            cell.onclick = (e) => e.stopPropagation();
        }
        
        // Save inline edit
        window.saveInlineEdit = async function(button, month, day, activity, eventId) {
            const cell = button.closest('td');
            const buttonContainer = cell.querySelector('.inline-edit-buttons');
            
            // Get text before buttons
            const textNode = Array.from(cell.childNodes).find(node => node.nodeType === Node.TEXT_NODE);
            const newText = textNode ? textNode.textContent.trim() : cell.textContent.replace(/💾 Save✖ Cancel/g, '').trim();
            
            if (!newText) {
                alert('Event title cannot be empty!');
                return;
            }
            
            // Remove buttons
            if (buttonContainer) buttonContainer.remove();
            
            // Make non-editable
            cell.contentEditable = false;
            cell.style.outline = 'none';
            cell.style.backgroundColor = '';
            cell.textContent = newText;
            
            // Update database
            try {
                console.log('Updating event:', { eventId, activity, title: newText });
                const result = await CalendarEventsAPI.update(eventId, activity, newText, '');
                
                if (result.success) {
                    console.log('✅ Event updated successfully');
                    // Update local events cache
                    if (events[month] && events[month][activity] && events[month][activity][day]) {
                        const eventIndex = events[month][activity][day].findIndex(e => e.id == eventId);
                        if (eventIndex !== -1) {
                            events[month][activity][day][eventIndex].title = newText;
                        }
                    }
                    
                    // Show success feedback
                    cell.style.backgroundColor = '#d1fae5';
                    setTimeout(() => {
                        cell.style.backgroundColor = '';
                    }, 1000);
                } else {
                    alert('Failed to update event: ' + (result.message || 'Unknown error'));
                    // Reload events to revert
                    await loadDatabaseEvents();
                    updateCalendarEventIndicators();
                }
            } catch (error) {
                console.error('Error updating event:', error);
                alert('Error updating event. Please try again.');
                // Reload events to revert
                await loadDatabaseEvents();
                updateCalendarEventIndicators();
            }
        };
        
        // Cancel inline edit
        window.cancelInlineEdit = function(button, originalText) {
            const cell = button.closest('td');
            const buttonContainer = cell.querySelector('.inline-edit-buttons');
            
            // Remove buttons
            if (buttonContainer) buttonContainer.remove();
            
            // Restore original text
            cell.textContent = originalText;
            cell.contentEditable = false;
            cell.style.outline = 'none';
            cell.style.backgroundColor = '';
        };
        
        // Update visual indicators for cells with calendar events
        function updateCalendarEventIndicators() {
            console.log('=== Updating Calendar Event Indicators ===');
            console.log('📊 Full events object:', JSON.stringify(events, null, 2));
            console.log('📊 Events structure:', events);
            
            // Remove all existing indicators and clear content
            document.querySelectorAll('.has-calendar-event').forEach(el => {
                el.classList.remove('has-calendar-event');
                el.classList.remove('editable-event-cell');
                // Clear old text content from previous updates
                if (el.dataset.hasEvent) {
                    el.textContent = '';
                    delete el.dataset.hasEvent;
                    delete el.dataset.dblClickAdded;
                    delete el.dataset.originalText;
                    delete el.dataset.eventId;
                }
            });
            
            let indicatorsAdded = 0;
            
            // Add blue highlighting to cells with events
            Object.keys(events).forEach(month => {
                console.log(`Processing month: ${month}`);
                Object.keys(events[month]).forEach(activity => {
                    console.log(`  Processing activity: ${activity}`);
                    Object.keys(events[month][activity]).forEach(day => {
                        console.log(`    Processing day: ${day}`);
                        const dayNum = parseInt(day);
                        const eventCount = events[month][activity][day].length;
                        
                        if (eventCount > 0) {
                            // Find cells for this month, activity, and day
                            const selector = `td[data-month="${month}"][data-activity="${activity}"][data-day="${dayNum}"]`;
                            const cells = document.querySelectorAll(selector);
                            
                            console.log(`Looking for: ${selector} (${eventCount} events)`);
                            console.log(`Found ${cells.length} cells`);
                            
                            cells.forEach(cell => {
                                // Only skip cells with training/main event content (not generic event-cell)
                                const hasPreDefinedContent = cell.classList.contains('prep-early') ||
                                                            cell.classList.contains('prep-mid') ||
                                                            cell.classList.contains('prep-final') ||
                                                            cell.classList.contains('main-event');
                                // Note: Removed event-cell from the skip list so database events can show
                                
                                if (!hasPreDefinedContent) {
                                    cell.classList.add('has-calendar-event');
                                    
                                    // Add event text to the cell
                                    const dayEvents = events[month][activity][day];
                                    console.log(`📋 Events for ${activity} ${month}/${day}:`, dayEvents);
                                    
                                    if (dayEvents && dayEvents.length > 0) {
                                        // Display first event title (or combine if multiple)
                                        const eventTitles = dayEvents.map(e => e.title || '(No title)').join(', ');
                                        console.log(`📝 Event titles: "${eventTitles}"`);
                                        
                                        // Mark that this cell has an event
                                        cell.dataset.hasEvent = 'true';
                                        
                                        // Clear any old content first
                                        cell.innerHTML = '';
                                        
                                        // Create a visible span element with the text
                                        const span = document.createElement('span');
                                        span.textContent = eventTitles;
                                        span.style.color = '#000000';
                                        span.style.fontSize = '0.72rem';
                                        span.style.fontWeight = '600';
                                        span.style.display = 'block';
                                        span.style.padding = '2px';
                                        span.style.lineHeight = '1.3';
                                        span.style.wordBreak = 'break-word';
                                        span.style.whiteSpace = 'normal';
                                        span.style.overflowWrap = 'break-word';
                                        span.style.hyphens = 'auto';
                                        span.style.maxWidth = '100%';
                                        cell.appendChild(span);
                                        
                                        cell.title = eventTitles + ' (Double-click to edit)'; // Tooltip
                                        
                                        // Force text visibility with inline styles (use !important)
                                        cell.style.setProperty('color', '#000000', 'important');
                                        cell.style.setProperty('font-size', '0.72rem', 'important');
                                        cell.style.setProperty('font-weight', '600', 'important');
                                        cell.style.setProperty('display', 'table-cell', 'important');
                                        cell.style.setProperty('white-space', 'normal', 'important');
                                        cell.style.setProperty('word-wrap', 'break-word', 'important');
                                        cell.style.setProperty('overflow-wrap', 'break-word', 'important');
                                        
                                        // Make editable for super admin
                                        if (isSuperAdmin()) {
                                            cell.contentEditable = false; // Start as non-editable
                                            cell.dataset.originalText = eventTitles;
                                            cell.dataset.eventId = dayEvents[0].id; // Store first event ID
                                            cell.classList.add('editable-event-cell');
                                            
                                            // Add double-click handler if not already added
                                            if (!cell.dataset.dblClickAdded) {
                                                cell.addEventListener('dblclick', function(e) {
                                                    e.stopPropagation();
                                                    makeInlineEditable(this, month, day, activity);
                                                });
                                                cell.dataset.dblClickAdded = 'true';
                                            }
                                        }
                                        
                                        console.log(`✅ Set text in cell: "${eventTitles}" for ${activity} ${month}/${day}`);
                                    } else {
                                        console.warn(`⚠️ No events found for ${activity} ${month}/${day}`);
                                    }
                                    
                                    indicatorsAdded++;
                                    console.log(`✅ Added blue to: ${activity} - ${month}/${day}`);
                                } else {
                                    console.log(`⊘ Skipped (has pre-defined content): ${activity} - ${month}/${day}`);
                                }
                            });
                        }
                    });
                });
            });
            
            console.log(`✅ Total blue indicators added: ${indicatorsAdded}`);
            console.log('=== Calendar Event Indicators Update Complete ===');
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async function() {
            // Check authentication
            if (!AuthAPI.isLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }
            
            console.log('=== Timeline Initialization Started ===');
            
            // Load events from database first
            await loadDatabaseEvents();
            console.log('Events loaded, now initializing handlers...');
            
            // Initialize cell handlers (this will also update indicators)
            initializeCellHandlers();
            
            // Make labels editable for super admin
            makeLabelsEditable();
            
            // Load saved Tindakan and Status values
            await loadSavedCellValues();
            
            // Apply default zoom (50%)
            applyZoom();
            
            console.log('Timeline initialized. Super Admin:', isSuperAdmin());
            console.log('=== Timeline Initialization Complete ===');
        });

        // Keyboard navigation
        const calendarWrapper = document.getElementById('calendarWrapper');
        
        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            // Close modals with Escape
            if (e.key === 'Escape') {
                closeEventModal();
                closeAddEventModal();
            }
            
            if (e.key === 'ArrowLeft') {
                calendarWrapper.scrollBy({ left: -200, behavior: 'smooth' });
            } else if (e.key === 'ArrowRight') {
                calendarWrapper.scrollBy({ left: 200, behavior: 'smooth' });
            }
        });

        // Month switching functionality
        async function switchMonth(month) {
            console.log(`Switching to month: ${month}`);
            
            // Update active tab
            document.querySelectorAll('.calendar-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById('tab-' + month).classList.add('active');

            // Update active month content
            document.querySelectorAll('.month-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('month-' + month).classList.add('active');
            
            // Reinitialize cell handlers for the new month (this will also update indicators)
            initializeCellHandlers();
            
            // Load saved Tindakan and Status values for this month
            await loadSavedCellValues();
        }

        // Zoom functionality
        let currentZoom = 50;  // Default zoom to 50%
        const minZoom = 50;
        const maxZoom = 200;
        const zoomStep = 10;

        function updateZoomDisplay() {
            document.getElementById('zoomDisplay').textContent = currentZoom + '%';
        }

        function applyZoom() {
            const wrappers = document.querySelectorAll('.calendar-wrapper');
            const zoomValue = currentZoom / 100;
            
            wrappers.forEach(wrapper => {
                // Use CSS zoom property for better compatibility
                wrapper.style.zoom = zoomValue;
            });
            
            updateZoomDisplay();
        }

        function zoomIn() {
            if (currentZoom < maxZoom) {
                currentZoom += zoomStep;
                applyZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > minZoom) {
                currentZoom -= zoomStep;
                applyZoom();
            }
        }

        function zoomReset() {
            currentZoom = 100;
            applyZoom();
        }

        // Keyboard shortcuts for zoom
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Plus/Equal for zoom in
            if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '=')) {
                e.preventDefault();
                zoomIn();
            }
            // Ctrl/Cmd + Minus for zoom out
            if ((e.ctrlKey || e.metaKey) && e.key === '-') {
                e.preventDefault();
                zoomOut();
            }
            // Ctrl/Cmd + 0 for reset zoom
            if ((e.ctrlKey || e.metaKey) && e.key === '0') {
                e.preventDefault();
                zoomReset();
            }
        });
    </script>
</body>
</html>

