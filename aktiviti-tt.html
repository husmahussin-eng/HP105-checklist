<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Aktiviti TT - RBPF HP-105</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="js/api-client.js?v=6"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f3f4f6;
        }
        .sidebar {
            width: 180px;
            height: 100vh;
            background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);
            position: fixed;
            left: 0;
            top: 0;
            color: white;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        }
        .main-content {
            margin-left: 180px;
            min-height: 100vh;
            background: #f3f4f6;
        }
        .top-bar {
            background: white;
            padding: 0.75rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .content-area {
            padding: 2rem;
        }
        .card {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div style="padding: 1.5rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <div style="width: 80px; height: 80px; margin: 0 auto 0.75rem; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 0.5rem; overflow: hidden;">
                <img src="rbpfnew.jpg" alt="RBPF Logo" style="width: 100%; height: 100%; object-fit: contain; border-radius: 50%; padding: 0.25rem;">
            </div>
            <div style="font-size: 1.125rem; font-weight: 700; margin-bottom: 0.25rem;">HP-105 CHECKLIST</div>
        </div>
        
        <div style="padding: 1rem 0;">
            <div style="font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 0.75rem 1.5rem 0.5rem; opacity: 0.6; font-weight: 600;">Main</div>
            <a href="demo-new-layout.html" style="padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.875rem; color: rgba(255,255,255,0.9); text-decoration: none;">
                <span>Dashboard</span>
            </a>
            <a href="acara-aktiviti.html" style="padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.875rem; color: rgba(255,255,255,0.9); text-decoration: none;">
                <span>Acara/Aktiviti</span>
            </a>
            <a href="meeting-list.html" style="padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.875rem; color: rgba(255,255,255,0.9); text-decoration: none;">
                <span>Minit Mesyuarat</span>
            </a>
            <a href="aktiviti-tambahan.html" style="padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.875rem; color: rgba(255,255,255,0.9); text-decoration: none;">
                <span>Aktiviti Tambahan</span>
            </a>
            <a href="budget.html" style="padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.875rem; color: rgba(255,255,255,0.9); text-decoration: none;">
                <span>Budget</span>
            </a>
            <a href="senarai-ajk.html" style="padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 0.875rem; color: rgba(255,255,255,0.9); text-decoration: none;">
                <span>Senarai AJK</span>
            </a>
        </div>
        
        <div style="padding: 1.5rem; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.5rem; opacity: 0.6; margin-top: auto;">
            HP105 (DKH) @2025
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <div>
                <h1 style="font-size: 1.25rem; font-weight: 700; color: #1f2937;">Aktiviti TT</h1>
            </div>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div style="text-align: right;">
                    <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937;" id="userName">Loading...</div>
                    <div style="font-size: 0.75rem; color: #6b7280;" id="userRole">-</div>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <div class="card">
                <div style="margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #4f46e5;">
                    <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">Aktiviti gotong-royong Aktiviti TT.</p>
                    <p style="color: #4f46e5; font-size: 0.75rem;">ðŸ“… Tarikh: 15 Januari 2026</p>
                </div>
                
                <section style="margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.125rem; font-weight: 700; color: #1f2937; margin-bottom: 1rem;">Maklumat Acara</h2>
                    
                    <!-- Saved Notes List -->
                    <div id="savedNotesList" style="margin-bottom: 1.5rem;"></div>

                    <!-- Add New Note Section -->
                    <div style="background: #f9fafb; padding: 1.5rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                        <h3 style="font-weight: 600; color: #374151; margin-bottom: 0.75rem;">Ruang Nota:</h3>
                        <div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb;">
                            <textarea id="noteInput" style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; resize: vertical; font-size: 0.875rem; font-family: inherit;" placeholder="Tambah nota di sini..."></textarea>
                            <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                                <button onclick="saveNote()" style="padding: 0.5rem 1rem; background: #4f46e5; color: white; border-radius: 0.375rem; font-weight: 600; font-size: 0.875rem; border: none; cursor: pointer; transition: background 0.2s;">
                                    Simpan Nota
                                </button>
                                <button onclick="clearInput()" style="padding: 0.5rem 1rem; background: #d1d5db; color: #374151; border-radius: 0.375rem; font-weight: 600; font-size: 0.875rem; border: none; cursor: pointer; transition: background 0.2s;">
                                    Padam
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    
    <script>
        // Check authentication
        if (!AuthAPI.isLoggedIn()) {
            window.location.href = 'login.html';
        }
        
        const user = AuthAPI.getCurrentUser();
        if (user) {
            document.getElementById('userName').textContent = user.username;
            document.getElementById('userRole').textContent = user.role === 'super_admin' ? 'Super Admin' : 'User';
        }
        
        // Day names in Malay
        const DAY_NAMES = ["Ahad", "Isnin", "Selasa", "Rabu", "Khamis", "Jumaat", "Sabtu"];
        
        // Format date
        function formatDate(date, user) {
            const dayName = DAY_NAMES[date.getDay()];
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${dayName}, ${day}/${month}/${year}, ${user}`;
        }
        
        let notes = [];
        
        // Save new note
        async function saveNote() {
            const input = document.getElementById('noteInput');
            const noteText = input.value.trim();
            
            if (noteText === '') {
                alert('Sila masukkan nota terlebih dahulu.');
                return;
            }

            const result = await NotesAPI.create('aktiviti-tt', noteText);
            
            if (result.success) {
                input.value = '';
                await loadNotesFromAPI();
            } else {
                alert('Gagal menyimpan nota: ' + result.message);
            }
        }
        
        // Clear input
        function clearInput() {
            document.getElementById('noteInput').value = '';
        }
        
        // Delete note
        async function deleteNote(id) {
            if (confirm('Adakah anda pasti mahu memadamkan nota ini?')) {
                const result = await NotesAPI.delete(id);
                if (result.success) {
                    await loadNotesFromAPI();
                } else {
                    alert('Gagal memadam nota: ' + result.message);
                }
            }
        }
        
        // Edit note
        async function editNote(id) {
            const note = notes.find(n => n.id === id);
            if (note) {
                const newText = prompt('Edit nota:', note.note_text || note.note_content);
                if (newText !== null && newText.trim() !== '') {
                    const result = await NotesAPI.update(id, newText.trim());
                    if (result.success) {
                        await loadNotesFromAPI();
                    } else {
                        alert('Gagal mengemaskini nota: ' + result.message);
                    }
                }
            }
        }
        
        // Render all notes
        function renderNotes() {
            const container = document.getElementById('savedNotesList');
            
            if (notes.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<div style="background: white; padding: 1rem; border-radius: 0.5rem; border: 1px solid #e5e7eb; margin-bottom: 1rem;">';
            html += '<h3 style="font-weight: 600; color: #374151; margin-bottom: 0.75rem;">Nota Tersimpan:</h3>';
            html += '<ul style="list-style: none; padding: 0;">';
            
            notes.forEach(note => {
                const noteText = note.note_text || note.note_content || note.text || '';
                const noteUser = note.username || note.created_by || (user ? user.username : 'Pengguna');
                let dateStr = '';
                
                if (note.timestamp) {
                    dateStr = formatDate(new Date(note.timestamp), noteUser);
                } else if (note.created_at) {
                    dateStr = formatDate(new Date(note.created_at), noteUser);
                } else if (note.date) {
                    dateStr = note.date;
                } else {
                    dateStr = formatDate(new Date(), noteUser);
                }
                
                html += `
                    <li style="display: flex; align-items: start; gap: 0.5rem; margin-bottom: 0.75rem; padding: 0.5rem; border-radius: 0.375rem; transition: background 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='transparent'">
                        <span style="color: #4f46e5; margin-top: 0.25rem; flex-shrink: 0;">â€¢</span>
                        <div style="flex-grow: 1;">
                            <span style="color: #374151; font-size: 0.875rem;">${noteText}</span>
                            <span style="color: #9ca3af; font-size: 0.75rem;"> (${dateStr})</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="editNote(${note.id})" style="color: #3b82f6; font-size: 0.75rem; padding: 0.25rem 0.5rem; background: transparent; border: none; cursor: pointer; font-weight: 500;" title="Edit">
                                Edit
                            </button>
                            <button onclick="deleteNote(${note.id})" style="color: #ef4444; font-size: 0.75rem; padding: 0.25rem 0.5rem; background: transparent; border: none; cursor: pointer; font-weight: 500;" title="Padam">
                                Padam
                            </button>
                        </div>
                    </li>
                `;
            });
            
            html += '</ul></div>';
            container.innerHTML = html;
        }
        
        // Load notes from API
        async function loadNotesFromAPI() {
            const result = await NotesAPI.getByPage('aktiviti-tt');
            if (result.success && result.data) {
                notes = result.data;
                renderNotes();
            }
        }
        
        // Initial load
        loadNotesFromAPI();
        
        // Allow Enter key to save (with Ctrl/Cmd)
        document.getElementById('noteInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                saveNote();
            }
        });
    </script>
</body>
</html>


